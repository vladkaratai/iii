<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>C - Twilio Client</title>
  <!-- –£–±—Ä–∞–Ω—ã –ø—Ä–æ–±–µ–ª—ã -->
  <script src="https://sdk.twilio.com/js/client/v1.14/twilio.min.js"></script>
</head>
<body>
  <h2>üìû C ‚Äî –ì–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–≤–æ–Ω–∫–∏</h2>
  <button id="init">‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å C (–Ω–∞–∂–º–∏ —Å–Ω–∞—á–∞–ª–∞)</button>
  <button id="answer" disabled>üìû –ü–æ–¥–Ω—è—Ç—å —Ç—Ä—É–±–∫—É</button>
  <button id="reject" disabled>‚ùå –°–±—Ä–æ—Å–∏—Ç—å</button>

  <script>
    let device = null;

    document.getElementById('init').onclick = async () => {
      try {
        const res = await fetch('https://burndial-twilio-cron.onrender.com/token-c?creator_id=C');
        const data = await res.json();

        if (!data.token) throw new Error('–¢–æ–∫–µ–Ω –Ω–µ –ø–æ–ª—É—á–µ–Ω');

        device = new Twilio.Device(data.token);

        device.on('register', () => {
          console.log('‚úÖ Client –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
          document.getElementById('answer').disabled = false;
          document.getElementById('reject').disabled = false;
        });

        device.on('error', err => {
          console.error('‚ùå Client error:', err.code, err.message);
        });

        device.on('incoming', conn => {
          console.log('üìû –í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫!');
          document.getElementById('answer').onclick = () => {
            console.log('‚úÖ –ü—Ä–∏–Ω—è–ª –∑–≤–æ–Ω–æ–∫');
            conn.accept();
          };
          document.getElementById('reject').onclick = () => {
            console.log('‚ùå –û—Ç–∫–ª–æ–Ω–∏–ª –∑–≤–æ–Ω–æ–∫');
            conn.reject();
          };
        });

        device.register();
        document.getElementById('init').disabled = true;
        document.getElementById('init').textContent = '‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω';
      } catch (err) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', err);
      }
    };
  </script>
</body>
</html>
